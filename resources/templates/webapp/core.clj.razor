@inherits Westwind.RazorHosting.RazorTemplateBase
(assembly-load "Owin")
(assembly-load "Microsoft.Owin.Diagnostics")
(assembly-load "Microsoft.Owin.Hosting")
@{
string coreNs = string.Format("{0}.core", Model["name"]);
string coreAssemblyName = string.Format("{0}.core", Model["safe-name"]);
}
(ns @coreNs
(:import [Microsoft.Owin.Hosting StartOptions WebApp]
           [Owin IAppBuilder WelcomePageExtensions])
  (:gen-class
   :methods [[Configuration [Owin.IAppBuilder] void]]))

(defn -Configuration [_ ^IAppBuilder app]
  (WelcomePageExtensions/UseWelcomePage app))

(defn -main [& args]
  (let [options (StartOptions. "http://localhost:9000/")]
    (set! (.AppStartup options) "@coreAssemblyName")
    (with-open [app (WebApp/Start options)]
      (println "Server running. Press [Enter] to stop.")
      (read-line))))
